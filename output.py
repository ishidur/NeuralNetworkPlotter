import numpy as np
import matplotlib.pyplot as plt, numpy as np
from mpl_toolkits.mplot3d import Axes3D
import matplotlib.gridspec as gridspec
import matplotlib.pyplot as plt
from matplotlib import cm

from pylab import *


def sigmoid(x):
    return 1 / (1 + np.exp(-x))


# Components of network(l=0,1,2,,,)
# neurons = np.array([2, 2, 1])
# str="2069,6.36879, 4.58608, 6.92113, 4.34442, -2.47962, -6.79904, 6.35838, -6.4943, -3.0653, 0.00999636"

# neurons = np.array([2, 3, 1])
# str="599,5.86581, -1.6873, 4.31575, 5.14747, 5.76717, 4.32641, -2.35129, -2.66479, -6.65975, 6.44388, 0.275338, -7.0809, -3.04433, 0.00990169"

# neurons = np.array([2, 4, 1])
# str="489,3.43153, 5.37924, 3.09733, -4.81061, 3.89932, -2.03991, 4.08778, 5.30856, -1.60353, -3.65043, -5.78128, -3.45817, 2.4249, 4.37504, -5.60206, 5.23461, -2.94186, 0.00974184"
# str="559,4.02681, 5.58551, -0.7994, 4.56916, 5.15392, 2.66137, 4.70171, 4.55158, -1.90552, -1.70361, -2.20378, -7.02321, 4.52788, 2.66148, 0.48565, -7.59381, -3.45308, 0.00998716"

# neurons = np.array([2, 2, 2, 1])
# str="1109,4.44087, 3.74287, 3.62482, 6.55838, -5.97092, -2.22584, 0.882932, 6.7804, 6.93495, 2.71067, -3.1506, -6.41817, 6.04266, -6.42694, -2.83843, 0.00994148"

# neurons = np.array([2, 3, 3, 1])
# str="659,2.94228, 6.20703, -2.15972, 3.93808, 0.541414, 5.70829, -4.48722, -3.09875, -2.88049, 0.410709, 2.58557, 5.1793, -3.65896, 5.98425, 2.29711, 5.80167, 0.759044, 2.06787, -3.63505, -2.65884, -6.25454, 5.50012, 5.79299, -6.6336, -2.97932, 0.00997591"

# neurons = np.array([2, 4, 4, 1])
# str="419,-1.74429, -0.864807, 2.92453, 6.19674, 4.60773, 4.9703, 2.47731, -0.3114, -1.48083, -1.94901, -1.82405, -2.70423, 1.29178, 1.90646, 3.67907, 3.17465, 1.96039, 2.25654, 3.70381, 2.85224, 3.2566, 1.70034, -0.0547112, -0.998359, 4.10569, 1.0241, -2.77683, -5.12003, -2.3828, -2.10662, 0.017373, -2.54969, 3.65127, -0.0783893, -5.69896, 6.04371, -0.56462, 0.00975528"

neurons = np.array([2, 3, 3, 3, 1])
str="9	-0.562377	-0.275068	6.08234	4.46247	4.61822	0.283341	-1.96811	-2.19457	-3.17061	2.26009	1.31546	2.51885	2.41162	1.15844	2.64848	1.26812	-5.03426	0.406915	-2.35325	1.09903	-2.36015	0.256109	2.36763	1.99073	4.24761	-2.63358	0.657033	1.2347	2.28027	2.57662	-2.88671	-1.32138	-2.70352	0.117933	0.0294466	0.0970494	-0.0267851	0.500658"
# str = "489,-0.984455, 6.36258, 1.31512, 5.34308, -0.259602, 3.90947, -2.3082, -2.99422, -2.51795, 3.53831, 2.97514, -0.236202, -0.607421, -3.18126, 5.8468, 2.93817, 1.88244, 1.20371, -2.67916, -1.07294, -3.15374, 4.6581, 1.7776, 4.60723, 3.82906, 3.63762, 0.860046, -2.19369, -5.37426, 5.4209, -0.674578, -2.15118, -2.18974, -5.85983, 5.7832, 4.95376, -1.68951, 0.00979133"
# str = "509,-1.70781, -0.173122, 6.26719, 4.03829, 5.46069, 0.332685, -1.46569, -2.68219, -3.26497, 2.72309, 2.70356, -0.798178, 3.97015, 2.84702, 0.575163, 0.696121, -3.09378, 5.53267, -3.29616, -1.55952, -2.40554, 1.96858, 4.14752, 4.92738, 4.21106, 0.681107, 3.92218, -4.62442, 5.4875, -1.79962, -3.12863, -2.17762, -1.15241, 6.11073, 4.92902, -5.754, -1.81388, 0.00969941"

# neurons = np.array([2, 4, 4, 4, 1])
# str="409,-0.697841, -0.897475, 5.89155, 2.80258, 4.32837, 4.94154, -0.0758867, 1.80829, -1.87105, -2.07275, -2.86402, -2.39909, 2.84368, -0.299338, 2.03284, 2.06372, 3.15449, -0.234366, 2.27524, 2.24656, -0.858545, 4.18735, 0.819846, -3.43302, 0.793896, 2.29869, 1.3733, -0.989186, -2.66895, -2.69498, -2.75059, -0.316513, 2.92055, 2.15683, 3.23589, 3.96045, -0.395392, -4.30458, 4.23023, -2.10206, 1.7894, 0.402521, 4.02238, 1.7857, 1.19637, 3.48859, -1.19052, 3.0998, -1.77703, -2.83522, -2.14077, -0.856841, -1.99668, 5.88102, 4.98794, -4.54769, -1.24244, 0.00964238"

# neurons = np.array([2, 3, 3, 3, 3, 1])
# str="1669,2.99655, 5.45868, -0.871209, 2.45073, 1.81667, 6.21747, -3.67208, -1.95684, -1.94578, 3.4826, 2.06384, 2.07905, 5.06989, 0.28875, 0.754481, 0.95933, 2.81964, 2.38933, -1.7991, -3.83407, -3.94271, 5.73188, -0.439558, -2.27671, 2.1846, 2.73404, 3.24917, 2.38703, 2.75653, 3.11856, -3.10315, -2.82318, -1.26783, -2.63199, 5.57446, -3.06424, 3.04046, 3.45285, 3.4489, 3.56043, 1.38017, 3.99581, 0.219994, -3.39757, -0.0944336, -3.16128, 4.8351, -4.39442, -0.271265, 0.00887238"

# neurons = np.array([2, 4, 4, 4, 4, 1])
# str="569,-1.40349, 4.73401, 4.39454, 0.595671, 4.97564, 0.42259, 0.771733, 4.30004, -1.80419, -2.58622, -2.56936, -2.5129, 1.83581, 3.4392, -0.204556, 0.398763, 0.792568, -1.43016, 2.91771, 2.28341, 0.879131, -1.14803, 2.79282, 2.22344, 2.18047, 3.13294, 0.705359, 1.13135, -2.82744, -1.78581, -3.03655, -2.89323, 1.03061, 1.89421, 2.23595, 2.15343, -2.15692, 0.608627, 3.56931, 3.36424, 4.22728, 2.43007, -0.47886, -0.399374, 3.16718, 2.28146, 0.342999, 0.369826, -3.10989, -2.88342, -2.5328, -2.45013, 2.24708, 5.1517, 3.20658, -3.59481, 3.07095, 1.6612, 3.52622, -0.620736, 2.52098, -0.216395, 2.42076, 4.33917, 2.43201, -0.209252, 2.35339, 4.06447, -2.22535, -3.26955, -2.67393, 0.342861, 4.07401, -5.84408, 5.11776, -5.81011, -0.2846, 0.00981299"
# str="439,-0.287801, -0.370451, 6.29973, 0.653061, 4.23102, 3.71699, 0.0611724, 3.48873, -2.04225, -1.74314, -3.15629, -2.23772, 1.43904, 1.49788, 0.789733, 2.19032, 1.17484, 1.23724, 0.882246, 1.98111, 2.07095, 1.81887, -5.23016, -1.6156, 1.52207, 1.54486, 0.0823191, 1.76094, -2.96707, -2.88946, 1.40339, -1.80337, 1.79505, 1.7683, 2.27846, -1.325, 1.89539, 1.86622, 2.15057, -1.06869, -0.0734473, -0.0853545, -3.63634, 4.84367, 2.74926, 2.69572, 0.537416, 2.14108, -2.99542, -2.92206, -1.37465, -1.79248, 2.44345, 2.47911, 1.84345, 3.66819, 2.39081, 2.42612, 1.7734, 3.6006, -1.05825, -1.12896, 3.9256, 2.71051, 3.5861, 3.65812, -3.99355, -1.97618, -1.09381, -1.11789, -3.86522, -1.3513, -2.39412, -2.44732, -5.81172, 6.0477, 1.40761, 0.00965746"

# via Excel
b = [float(k) for k in str.split('\t')]
# via Sublime
# b = [float(k) for k in str.split(',')]

weights = []
biases = []
iter = 1
for i in range(len(neurons) - 1):
    m = []
    for j in range(neurons[i]):
        m.append(b[iter:iter + neurons[i + 1]])
        iter += neurons[i + 1]
    biases.append(np.matrix(b[iter:iter + neurons[i + 1]]).transpose())
    iter += neurons[i + 1]
    weights.append(np.matrix(m).transpose())


def calcOutput(x, y):
    inputs = weights[0] * np.matrix([[x], [y]]) + biases[0]
    for i in range(len(neurons) - 2):
        outputs = sigmoid(inputs)
        inputs = weights[i + 1] * outputs + biases[i + 1]
    outputs = sigmoid(inputs)
    return outputs[0, 0]


def meshgrid_propagation_forMap(layersArray):
    N = 100
    xyRange = 1.0
    # グリッド作成
    x = np.linspace(0, xyRange, N)
    y = np.linspace(0, xyRange, N)
    X, Y = np.meshgrid(x, y)  # グリッド領域を示すマトリックスの構成
    Z = np.array(list(map(lambda x, y: list(map(calcOutput, x, y)), X, Y)))
    pcolor(X, Y, Z)
    colorbar()
    pink()

    # fig = plt.figure()
    # ax = Axes3D(fig)
    # ax.plot_surface(X, Y, Z, rstride=1, cstride=1,cmap=cm.coolwarm)
    # ax.plot_wireframe(X,Y,Z)
    plt.xlabel('Input1', fontsize=18)
    plt.ylabel('Input2', fontsize=18)
    # ax.set_zlabel('O')
    plt.xlim(0, 1.0)
    plt.ylim(0, 1.0)
    plt.legend(fontsize=18)
    plt.tick_params(labelsize=18)
    plt.grid()
    # plt.savefig("time"+str(learningTime)+"Neuron"+str(neurons)+"samp"+str(samplingTime)+"rand"+str(maxOfRandom)+"r"+str()+".png")
    plt.show()


meshgrid_propagation_forMap(neurons)
